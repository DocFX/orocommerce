<% let productUniqId = _.uniqueId('product-') %>
<% let galleryOpener = 'data-trigger-gallery-open-' + productUniqId %>
<% let _image = obj.subData && obj.subData[0].image || obj.image %>
<% let _sku = obj.subData && obj.subData[0].sku || sku %>
<% let _productId = obj.subData && obj.subData[0].productId || productId %>
<% let clipLength = 30 %>
<div class="product-item">
    <div class="grid-line-items">
        <div class="grid-line-items__row grid-line-items__row--offset-y-end">
            <% if (_image) { %>
            <div class="product-item__image-holder--aspect-ratio product-item__image-holder--tiny">
                <div class="product-item__preview"
                     data-page-component-module="orofrontend/js/app/components/popup-gallery-widget"
                     data-page-component-options="<%- JSON.stringify({
                            ajaxMode: true,
                            ajaxRoute: 'oro_product_frontend_ajax_images_by_id',
                            id: _productId,
                            galleryFilter: 'product_gallery_popup',
                            alt: name,
                            uniqueTriggerToOpenGallery: '[data-role="' + galleryOpener + '"]'
                     }) %>"
                >
                    <picture class="product-item__preview-picture" data-object-fit="">
                        <img src="<%- _image %>"
                             title="<%- _sku %>"
                             alt="<%- name %>"
                             class="product-item__preview-image" >
                    </picture>
                </div>
                <button class="view-product-gallery stretched"
                        data-role="<%- galleryOpener %>"
                        aria-label="<%- _.__('oro.product.images.zoom.label') %>">
                    <span class="view-product-gallery__icon" aria-hidden="true"></span>
                </button>
            </div>
            <% } else { %>
            <div class="product-item__image-holder product-item__image-holder--tiny">
                <img src="<%- imagePlaceholder %>"
                     title="<%- _sku %>"
                     alt="<%- name %>"
                     class="product-item__preview-image">
            </div>
            <% } %>
        </div>
        <div class="grid-line-items__row">
            <div class="grid-line-items__row-item">
            <% let renderProductConfiguration = function(configuration) { %>
                <%= _.map(configuration, function(field) {
                    return field.label + ': <span class="bold">' + field.value + '</span>';
                }).join(', ') %>
            <% } %>
            <% if (!obj.productConfiguration) { %>
                <% let renderProductName = function(clip) { %>
                    <h3 class="grid-line-items__title<%- clip ? ' grid-line-items__clip-placeholder' : '' %>">
                        <a<% if (clip) { %> class="<%- 'grid-line-items__ellipsis' %>"<% }%>
                        href="<%- link %>"
                        title="<%- name %>"><%- name %></a>
                    </h3>
                <% } %>
                <% if (name && name.length <= clipLength) { %>
                    <% renderProductName() %>
                <% } else {%>
                <div class="grid-line-items__clip-title-container">
                    <% renderProductName(true) %>
                </div>
                <% } %>
                <% if (obj.subData) { %>
                    <% renderProductConfiguration(obj.subData[0].productConfiguration) %>
                <% } %>
            <% } else { %>
                <%- sku %><br >
                <% renderProductConfiguration(productConfiguration) %>
            <% } %>
            </div>
            <% if (note) { %>
            <div class="grid-line-items__row-item">
                <% let renderNote = function(clip) { %>
                    <div class="grid-line-items__text<%- clip ? ' grid-line-items__ellipsis' : '' %>" data-role="note"><%- note %></div>
                <% } %>
                <% if (note.length <= clipLength) { %>
                    <% renderNote() %>
                <% } else { %>
                <div class="grid-line-items__clip-text-container" data-page-component-view="oroshoppinglist/js/app/views/preview-full-note-view">
                    <div class="grid-line-items__clip-placeholder">
                        <% renderNote(true) %>
                    </div>
                </div>
                <% } %>
            </div>
            <% } %>
        </div>
    </div>
</div>
